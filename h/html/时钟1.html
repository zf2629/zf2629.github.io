<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta http-equiv="Cache-Control" content="no-siteapp">
    <meta http-equiv="Cache-Control" content="no-transform">
    <meta name="applicable-device" content="pc,mobile">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>时钟1</title>
    <style>
        body {
            background: #fff;
        }

        .clock {

            position: absolute;

            opacity: 1

        }

        .fill .clock {

            left: 50%;

            top: 50%

        }

        .centre {

            position: absolute;

            top: 50%;

            left: 50%;

            width: 0;

            height: 0

        }

        .expand {

            position: absolute;

            top: 0;

            left: 0;

            transform: translate(-50%, -50%)

        }

        .anchor {

            position: absolute;

            top: 0;

            left: 0;

            width: 0;

            height: 0

        }

        .element {
            position: absolute;
            top: 0;
            left: 0
        }

        .round {
            border-radius: 296px
        }

        .circle-1 {

            background: #000;

            width: 12px;

            height: 12px

        }

        .circle-2 {

            background: #000;

            width: 8px;

            height: 8px

        }

        .circle-3 {

            background: red;

            width: 4px;

            height: 4px

        }

        .second {
            /*transform: rotate(180deg)*/
        }

        .minute {
            /*transform: rotate(54deg)*/
        }

        .second-hand {
            width: 2px;
            height: 150px;
            background: red;
            transform: translate(-50%, -100%) translateY(24px)
        }

        .hour {
            /*transform: rotate(304.5deg)*/
        }


        .light .thin-hand {

            width: 4px;

            height: 50px;

            background: #000;

            transform: translate(-50%, -100%)

        }

        .night .thin-hand {

            width: 4px;

            height: 50px;

            background: #fff;

            transform: translate(-50%, -100%)

        }

        .light .fat-hand {

            width: 10px;

            height: 57px;

            border-radius: 10px;

            background: #000;

            transform: translate(-50%, -100%) translateY(-18px)

        }

        .night .fat-hand {

            width: 10px;

            height: 57px;

            border-radius: 10px;

            background: #fff;

            transform: translate(-50%, -100%) translateY(-18px)

        }

        .minute-hand {
            height: 88px
        }


        .light .hour-text {

            position: absolute;

            font: 2em Hei, Helvetica, Arial, sans-serif;

            color: #000;

            transform: translate(-50%, -50%)

        }

        .night .hour-text {

            position: absolute;

            font: 2em Hei, Helvetica, Arial, sans-serif;

            color: #fff;

            transform: translate(-50%, -50%)

        }

        .hour-10 {
            padding-left: .4ex
        }

        .hour-11 {
            padding-left: .25ex
        }

        .light .minute-text {

            position: absolute;

            font: 1em Avenir Next, Helvetica, Arial, sans-serif;

            color: #000;

            transform: translate(-50%, -50%)

        }

        .night .minute-text {

            position: absolute;

            font: 1em Avenir Next, Helvetica, Arial, sans-serif;

            color: #fff;

            transform: translate(-50%, -50%)

        }

        .light .minute-line {

            background: #000;

            color: #000;

            width: 1px;

            height: 9px;

            transform: translate(-50%, -100%) translateY(-131px);

            opacity: .34

        }

        .night .minute-line {

            background: #fff !important;

            color: #fff !important;

            width: 1px;

            height: 9px;

            transform: translate(-50%, -100%) translateY(-131px);

            opacity: .34

        }
    </style>
</head>
<body style="display: none;">
<div class="light" id="myclock">
    <div class="fill">
        <div class="reference"></div>
        <div class="clock" id="utility-clock">
            <div class="centre">
                <div class="dynamic"></div>
                <div class="expand round circle-1"></div>
                <div class="anchor hour">
                    <div class="element thin-hand"></div>
                    <div class="element fat-hand"></div>
                </div>
                <div class="anchor minute">
                    <div class="element thin-hand"></div>
                    <div class="element fat-hand minute-hand"></div>
                </div>
                <div class="anchor second">
                    <div class="element second-hand"></div>
                </div>
                <div class="expand round circle-2"></div>
                <div class="expand round circle-3"></div>
            </div>
        </div>
    </div>
</div>
<script>
    var clock = document.querySelector('#utility-clock')

    utilityClock(clock)

    if (clock.parentNode.classList.contains('fill')) autoResize(clock, 295 + 32)

    function utilityClock(container) {
        var dynamic = container.querySelector('.dynamic')
        var hourElement = container.querySelector('.hour')
        var minuteElement = container.querySelector('.minute')
        var secondElement = container.querySelector('.second')

        // 创建分钟刻度（每5分钟一个数字）
        var minute = function (n) {
            return n % 5 == 0 ? minuteText(n) : minuteLine(n)
        }

        // 创建分钟数字标记
        var minuteText = function (n) {
            var element = document.createElement('div')
            element.className = 'minute-text'
            element.innerHTML = (n < 10 ? '0' : '') + n
            position(element, n / 60, 135)
            dynamic.appendChild(element)
        }

        // 创建分钟短线标记
        var minuteLine = function (n) {
            var anchor = document.createElement('div')
            anchor.className = 'anchor'
            var element = document.createElement('div')
            element.className = 'element minute-line'
            rotate(anchor, n * 6) // 修正角度计算
            anchor.appendChild(element)
            dynamic.appendChild(anchor)
        }

        // 创建小时数字
        var hour = function (n) {
            var element = document.createElement('div')
            element.className = 'hour-text hour-' + n
            element.innerHTML = n
            position(element, n / 12, 105)
            dynamic.appendChild(element)
        }

        var position = function (element, phase, r) {
            var theta = phase * 2 * Math.PI
            element.style.top = (-r * Math.cos(theta)).toFixed(1) + 'px'
            element.style.left = (r * Math.sin(theta)).toFixed(1) + 'px'
        }

        // 专门用于秒针的角度计算函数
        var rotateSecond = function (element, degree) {
            element.style.transform = element.style.webkitTransform = 'rotate(' + degree + 'deg)'
        }

        // 用于分针和时针的角度计算函数
        var rotate = function (element, degree) {
            element.style.transform = element.style.webkitTransform = 'rotate(' + degree + 'deg)'
        }

        var animate = function () {
            var now = new Date()
            var milliseconds = now.getMilliseconds()
            var seconds = now.getSeconds()
            var minutes = now.getMinutes()
            var hours = now.getHours()

            // 精确计算各指针的角度
            var secondDegree = seconds * 6  // 秒针: 每秒6度
            var minuteDegree = (minutes + seconds / 60) * 6  // 分针: 每分钟6度
            var hourDegree = (hours % 12 + minutes / 60) * 30  // 时针: 每小时30度

            // 应用旋转角度
            rotateSecond(secondElement, secondDegree)
            rotate(minuteElement, minuteDegree)
            rotate(hourElement, hourDegree)

            setTimeout(function () {
                animate();
            }, 1000); // 每秒更新一次
        }

        // 创建分钟刻度（0-60分钟）
        for (var i = 1; i <= 60; i++) minute(i)

        // 创建小时数字（1-12小时）
        for (var i = 1; i <= 12; i++) hour(i)

        animate()
    }


    function autoResize(element, nativeSize) {

        var update = function () {

            var scale = Math.min(window.innerWidth, window.innerHeight) / nativeSize

            element.style.transform = element.style.webkitTransform = 'scale(' + scale.toFixed(3) + ')'

        }

        update()

        window.addEventListener('resize', update)

    }

    //自动反色
    function darkModeHandler() {
        const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches;
        if (isDarkMode) {
            document.querySelector('body').setAttribute('style', 'background-color:#1b1b1b;color:#fff');
            let div = document.querySelector('#myclock');
            div.className = "night";
        }
        document.querySelector('body').style.setProperty('display', 'block');
    }
    // 初始检测
    document.addEventListener('DOMContentLoaded', darkModeHandler);
    window.addEventListener('load', darkModeHandler);
    // 延迟检测（防止某些设备初始值不准确）
    setTimeout(darkModeHandler, 100);
    // 监听暗色模式变化
    const darkModeMediaQuery = window.matchMedia('(prefers-color-scheme: dark)');
    darkModeMediaQuery.addListener(darkModeHandler);
    // 监听DOM变化（适用于动态加载内容）
    const observer = new MutationObserver(darkModeHandler);
    observer.observe(document.documentElement, { childList: true, subtree: true });
</script>
</body>
</html>